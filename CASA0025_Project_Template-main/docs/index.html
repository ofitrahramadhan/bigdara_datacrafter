<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CROPINVEST - Crop Yield Estimator</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CROPINVEST - Crop Yield Estimator</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><img src="Captnknure.JPG" class="img-fluid"></p>
<section id="project-summary" class="level2">
<h2 class="anchored" data-anchor-id="project-summary"><strong>Project Summary</strong></h2>
<p>CROPINVEST - Crop Yield Estimator for the State of North Dakota, USA</p>
</section>
<section id="problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="problem-statement"><strong>Problem Statement</strong></h2>
<p>What is the problem you’re trying to address using this application?</p>
</section>
<section id="end-user" class="level2">
<h2 class="anchored" data-anchor-id="end-user"><strong>End User</strong></h2>
<p>Who are you building this application for? How does it address a need this community has?</p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data"><strong>Data</strong></h2>
<p>Datasets that we have used &amp; the relevant data from the dataset which we have used are described below in detail:-</p>
<ol type="1">
<li><strong>United States Census Bureau TIGER Dataset</strong> It contains the boundary information i.e.&nbsp;counties of states which are the primary legal divisions units of US states.
<ul>
<li><em>Dataset:</em> ee.ImageCollection(“TIGER/2016/Counties”)</li>
<li><em>Dataset Provider:</em> United States Census Bureau</li>
<li><em>Data Used for our Study:</em> <code>STATEFP</code> parameter of the dataset which provides the State FIPS code &amp; the North Dakota value is used. <br><br><br>
</li>
</ul></li>
<li><strong>USDA NASS Cropland Data Layers</strong> It is a crop-specific land cover data layer created annually for the continental United States using moderate resolution satellite imagery and extensive agricultural ground truth.
<ul>
<li><em>Dataset:</em> ee.FeatureCollection(“USDA/NASS/CDL”)</li>
<li><em>Dataset Provider:</em> USDA National Agricultural Statistics Service</li>
<li><em>Data Used for our Study:</em> <code>cropland</code> values for different crops of our study are used Wheat, Corn &amp; Soybean Values provided from the Cropland Table. <br><br><br>
</li>
</ul></li>
<li><strong>MOD13Q1.061 Terra Vegetation Indices 16-Day Global</strong> It provides Normalized Difference Vegetation Index (NDVI) value on a per pixel basis.
<ul>
<li><em>Dataset:</em> ee.ImageCollection(“MODIS/061/MOD13Q1”)</li>
<li><em>Dataset Provider:</em> NASA LP DAAC at the USGS EROS Center</li>
<li><em>Data Used for our Study:</em> <code>NDVI</code> parameter of the dataset which provides the Normalized Difference Vegetation Index. <br><br><br>
</li>
</ul></li>
<li><strong>GRIDMET:Gridded Surface Meteorological Dataset</strong> It provides the high spatial resolution (~4-km) daily surface fields of temperature, precipitation, winds, humidity and radiation across the contiguous United States from 1979.
<ul>
<li><em>Dataset:</em> ee.ImageCollection(“IDAHO_EPSCOR/GRIDMET”)</li>
<li><em>Dataset Provider:</em> USDA National Agricultural Statistics Service</li>
<li><em>Data Used for our Study:</em> <code>pr</code> parameter of the dataset which provides the ‘Precipitation amount’ in mm (daily total) <br><br><br>
</li>
</ul></li>
<li><strong>Sentinel-1 SAR GRD</strong> It contains the boundary information i.e.&nbsp;counties of states which are the primary legal divisions units of US states.
<ul>
<li><em>Dataset:</em> ee.ImageCollection(“COPERNICUS/S1_GRD”)</li>
<li><em>Dataset Provider:</em> European Union/ESA/Copernicus</li>
<li><em>Data Used for our Study:</em> <code>VV</code> parameter of the dataset which provides ‘Single co-polarization, vertical transmit/vertical receive’ in dB. <br><br></li>
</ul></li>
<li><strong>SPL3SMP_E.005 SMAP L3 Radiometer Global Daily 9km Soil Moisture</strong> It provides a daily composite of global land surface conditions retrieved by the Soil Moisture Active Passive (SMAP) L-Band radiometer. The daily data here were collected from the descending (local solar time of 6 am) and ascending (local solar time of 6 pm) passes.
<ul>
<li><em>Dataset:</em> ee.ImageCollection(“NASA/SMAP/SPL3SMP_E/005”)</li>
<li><em>Dataset Provider:</em> Google and NSIDC</li>
<li><em>Data Used for our Study:</em> <code>soil_moisture_am</code> &amp; <code>soil_moisture_pm</code>parameter of the dataset which provides ’Retrieved soil moisture estimate from the disaggregated/downscaled vertical polarization brightness temperature at 9-km grid cell one at AM overpass &amp; other at PM overpass.in dB. <br><br></li>
</ul></li>
<li><strong>MOD11A1.061 Terra Land Surface Temperature</strong> MOD11A1 V6.1 product provides daily land surface temperature (LST) along with other parameters.
<ul>
<li><em>Dataset:</em> ee.ImageCollection(“NASA/SMAP/SPL3SMP_E/005”)</li>
<li><em>Dataset Provider:</em> NASA LP DAAC at the USGS EROS Center</li>
<li><em>Data Used for our Study:</em> <code>LST_Day_1km</code> &amp; <code>LST_Night_1km</code>parameter of the dataset which provides ‘Daytime Land Surface Temperature’ &amp; Daytime Land Surface Temperature’ both in Kelvin (K). <br><br></li>
</ul></li>
<li><strong>MCD18C2.061 Photosynthetically Active Radiation Daily 3 hour</strong> The MCD18C2 Version 6.1 is a Moderate Resolution Imaging Spectroradiometer (MODIS) Terra and Aqua combined Photosynthetically Active Radiation (PAR) gridded Level 3 product produced daily at 0.05 degree (5,600 meters at the equator) resolution with estimates of PAR every 3 hours.
<ul>
<li><em>Dataset:</em> ee.ImageCollection(“MODIS/061/MCD18C2”)</li>
<li><em>Dataset Provider:</em> NASA LP DAAC at the USGS EROS Center</li>
<li><em>Data Used for our Study:</em> <code>GMT_1200_PAR</code> parameter of the dataset which provides ‘Total PAR at GMT 12:00’.PAR is incident solar radiation in the visible spectrum (400-700 nanometers) and is an important variable in land-surface models having use in agriculture &amp; other scientific applications. <br><br></li>
</ul></li>
<li><strong>MOD16A2GF.061: Terra Net Evapotranspiration</strong> It includes inputs of daily meteorological reanalysis data along with MODIS remotely sensed data products such as vegetation property dynamics, albedo, and land cover. The pixel values for the two Evapotranspiration layers (ET and PET) are the sum of all eight days within the composite period, and the pixel values for the two Latent Heat layers (LE and PLE) are the average of all eight days within the composite peri.
<ul>
<li><em>Dataset:</em> ee.ImageCollection(“MODIS/061/MOD16A2GF”)</li>
<li><em>Dataset Provider:</em> NASA LP DAAC at the USGS EROS Center</li>
<li><em>Data Used for our Study:</em> <code>ET</code> parameter of the dataset which provides ‘Total evapotranspiration’ in kg/m^2/8day.s. <br><br></li>
</ul></li>
</ol>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology"><strong>Methodology</strong></h2>
<p>Previous studies showed that RF is an effective and universal machine learning method for crop yield prediction on a regional and global scale with high accuracy and precision and ease of use (Jeong et al., 2016.; Prasad et al., 2021).</p>
<section id="building-random-forest-model" class="level3">
<h3 class="anchored" data-anchor-id="building-random-forest-model">Building Random Forest Model:</h3>
<ol type="1">
<li><p><strong>Prepare original CSV including the three types of crop among several X variables and Y variable (the crop yield)</strong></p></li>
<li><p><strong>Prepare training/validation data</strong></p></li>
<li><p><strong>Use the training data to train three different RF Models in GEE</strong></p></li>
</ol>
</section>
<section id="validation" class="level3">
<h3 class="anchored" data-anchor-id="validation">Validation</h3>
<p>To get the performance of our models, we can use the test data from the previous split. We used R square and Root Mean Squared Error (RMSE) to validate our models. There are some graphs showing these metrics:</p>
<p>:::{.column-page}</p>
<div style="position: relative; width: 100%; height: 0; padding-top: 56.2500%;
 padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 1.6em; margin-bottom: 0.9em; overflow: hidden;
 border-radius: 8px; will-change: transform;">
<p><iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;" src="https://www.canva.com/design/DAGC-BnkFTM/htfGBGmKgWUiwQRlwaqXgQ/view?embed" allowfullscreen="allowfullscreen" allow="fullscreen"> </iframe> &lt;a::: d Wi</p>
<section id="inte" class="level4">
<h4 class="anchored" data-anchor-id="inte">**Inte</h4>
<p>face**nterface</p>
Here is a presentation to show, how our ap l
<div style="position: relative; width: 100%; height: 0; padding-top: 56.2500%;
 padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 1.6em; margin-bottom: 0.9em; overflow: hidden;
 border-radius: 8px; will-change: transform;">
<p><iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;" src="https://www.canva.com/design/DAGCq_eFmq8/Muz__V20V7SJUNr3EVBSEQ/view?embed" allowfullscreen="allowfullscreen" allow="fullscreen"> </iframe></p>
</div>
<p><a href="https://www.canva.com/design/DAGCq_eFmq8/Muz__V20V7SJUNr3EVBSEQ/view?utm_content=DAGCq_eFmq8&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link" target="_blank" rel="noopener">CropInvest-Buradi a:<strong>:: d Wani/ifram</strong>&gt;</a></p><a href="https://www.canva.com/design/DAGCq_eFmq8/Muz__V20V7SJUNr3EVBSEQ/view?utm_content=DAGCq_eFmq8&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link" target="_blank" rel="noopener">
</a></section><a href="https://www.canva.com/design/DAGCq_eFmq8/Muz__V20V7SJUNr3EVBSEQ/view?utm_content=DAGCq_eFmq8&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link" target="_blank" rel="noopener">
</a></div><a href="https://www.canva.com/design/DAGCq_eFmq8/Muz__V20V7SJUNr3EVBSEQ/view?utm_content=DAGCq_eFmq8&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link" target="_blank" rel="noopener">
</a></section><a href="https://www.canva.com/design/DAGCq_eFmq8/Muz__V20V7SJUNr3EVBSEQ/view?utm_content=DAGCq_eFmq8&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link" target="_blank" rel="noopener">
</a></section><a href="https://www.canva.com/design/DAGCq_eFmq8/Muz__V20V7SJUNr3EVBSEQ/view?utm_content=DAGCq_eFmq8&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link" target="_blank" rel="noopener" class="page-columns page-full">
<section id="the-application" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="the-application">The Application</h2>
<div class="column-page">
<p>&lt;iframe src=‘https://songzimeng.users.earthengine.app/view/north-dakota-crop-yield’ width=‘100%’ heigh<strong>t=‘700px’&gt;&lt;/</strong>frame&gt;</p>
</div>
</section>
</a><section id="how-it-works" class="level2"><a href="https://www.canva.com/design/DAGCq_eFmq8/Muz__V20V7SJUNr3EVBSEQ/view?utm_content=DAGCq_eFmq8&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link" target="_blank" rel="noopener">
<h2 class="anchored" data-anchor-id="how-it-works">How it Works</h2>
</a><section id="data-extraction-code" class="level3"><a href="https://www.canva.com/design/DAGCq_eFmq8/Muz__V20V7SJUNr3EVBSEQ/view?utm_content=DAGCq_eFmq8&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link" target="_blank" rel="noopener">
<h3 class="anchored" data-anchor-id="data-extraction-code">Data Extraction Code:</h3>
</a><ul><a href="https://www.canva.com/design/DAGCq_eFmq8/Muz__V20V7SJUNr3EVBSEQ/view?utm_content=DAGCq_eFmq8&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link" target="_blank" rel="noopener">
<li>Here we use the Python environment to extract the data from different datasets using Google Earth Engine API</li>
<li>Afterwards, we first use the crop-specific land cover data to distinguish different crops- wheat, soybean or corn for each county in North Dakota.</li>
<li>Further, NDVI, Precipitation, SAR, Soil Moisture &amp; other values are used to get the county-wise values from the year 2000-2024.</li>
</a><li><a href="https://www.canva.com/design/DAGCq_eFmq8/Muz__V20V7SJUNr3EVBSEQ/view?utm_content=DAGCq_eFmq8&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link" target="_blank" rel="noopener">Afterwards, the Yield data is obtained from the </a><a href="https://quickstats.nass.usda.gov/">United States Department of Agriculture</a> for each of the years and a final dataset is obtained which has all the X Variables (GEOID,NDVI,PA,SAR,SMS_AM,LST_DAY,SMS_PM,LST_NIGHT,PAR,ET) &amp; Y variable (YIELD).</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pip install earthengine<span class="op">-</span>api</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ee</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> processYear(year):</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load the CDL dataset for the given year</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> ee.ImageCollection(<span class="st">'USDA/NASS/CDL'</span>)<span class="op">\</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                .<span class="bu">filter</span>(ee.Filter.date(<span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-01-01'</span>, <span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-12-31'</span>))<span class="op">\</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                .first()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    crop_landcover <span class="op">=</span> dataset.select(<span class="st">'cropland'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for North Dakota counties</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#`STATEFP` parameter of the dataset which provides the State FIPS code &amp; the North Dakota value is used.</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    counties <span class="op">=</span> ee.FeatureCollection(<span class="st">'TIGER/2016/Counties'</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    nd <span class="op">=</span> counties.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'STATEFP'</span>, <span class="st">'38'</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify corn areas in North Dakota</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#`cropland` values for different crops of our study are used Wheat, Corn &amp; Soybean Values provided from the Cropland Table.</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    corn <span class="op">=</span> crop_landcover.eq(<span class="dv">1</span>).Or(crop_landcover.eq(<span class="dv">12</span>)).Or(crop_landcover.eq(<span class="dv">13</span>))</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    masked_corn <span class="op">=</span> crop_landcover.updateMask(corn).clipToCollection(nd)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate NDVI for corn areas using MODIS data</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#`NDVI` parameter of the dataset and we obtain the mean over the growth period of the crop</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    NDVI_dataset <span class="op">=</span> ee.ImageCollection(<span class="st">'MODIS/061/MOD13Q1'</span>)<span class="op">\</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                    .<span class="bu">filter</span>(ee.Filter.date(<span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-05-01'</span>, <span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-10-01'</span>))</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> NDVI_dataset.select(<span class="st">'NDVI'</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    mean_ndvi <span class="op">=</span> ndvi.mean().rename(<span class="st">'NDVI'</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    cornNDVI <span class="op">=</span> mean_ndvi.updateMask(masked_corn)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate precipitation using GRIDMET data</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#`pr` parameter of the dataset which provides the 'Precipitation amount' in mm (daily total)</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    precipitation_dataset <span class="op">=</span> ee.ImageCollection(<span class="st">"IDAHO_EPSCOR/GRIDMET"</span>)<span class="op">\</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                             .<span class="bu">filter</span>(ee.Filter.date(<span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-05-01'</span>, <span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-10-01'</span>))<span class="op">\</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                             .select(<span class="st">'pr'</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    mean_precipitation <span class="op">=</span> precipitation_dataset.mean().rename(<span class="st">'PA'</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load Sentinel-1 C-band SAR Image Collection for the given year, select VV polarization</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">#`VV` parameter of the dataset which provides 'Single co-polarization, vertical transmit/vertical receive' in dB.</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    s1_dataset <span class="op">=</span> ee.ImageCollection(<span class="st">"COPERNICUS/S1_GRD"</span>)<span class="op">\</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                   .<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'instrumentMode'</span>, <span class="st">'IW'</span>))<span class="op">\</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                   .<span class="bu">filter</span>(ee.Filter.listContains(<span class="st">'transmitterReceiverPolarisation'</span>, <span class="st">'VV'</span>))<span class="op">\</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                   .<span class="bu">filter</span>(ee.Filter.date(<span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-01-01'</span>, <span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-12-31'</span>))<span class="op">\</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                   .select(<span class="st">'VV'</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    mean_s1_vv <span class="op">=</span> s1_dataset.mean().rename(<span class="st">'SAR'</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load Radiometer Global Daily 9 km Soil Moisture AM</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">#`soil_moisture_am` &amp; `soil_moisture_pm` parameter of the dataset which provides 'Retrieved soil moisture estimate from the</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># disaggregated/downscaled vertical polarization brightness temperature at 9-km grid cell one at AM overpass &amp; other at  PM overpass. in dB.</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    smap_dataset <span class="op">=</span> ee.ImageCollection(<span class="st">"NASA/SMAP/SPL3SMP_E/005"</span>)<span class="op">\</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>                    .<span class="bu">filter</span>(ee.Filter.date(<span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-05-01'</span>, <span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-10-01'</span>))<span class="op">\</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>                    .select(<span class="st">'soil_moisture_am'</span>)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    mean_soil_moisture <span class="op">=</span> smap_dataset.mean().rename(<span class="st">'SMS_AM'</span>)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load Radiometer Global Daily 9 km Soil Moisture PM</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    smapDataset_pm <span class="op">=</span> ee.ImageCollection(<span class="st">"NASA/SMAP/SPL3SMP_E/005"</span>)<span class="op">\</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>                       .<span class="bu">filter</span>(ee.Filter.date(<span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-05-01'</span>, <span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-10-01'</span>))<span class="op">\</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>                       .select(<span class="st">'soil_moisture_am'</span>) </span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    meanSoilMoisture_pm <span class="op">=</span> smapDataset_pm.mean().rename(<span class="st">'SMS_PM'</span>)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load MODIS Land Surface Temperature DAY</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">#`LST_Day_1km` &amp; `LST_Night_1km` parameter of the dataset which provides 'Daytime Land Surface Temperature' &amp;</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nighttime Land Surface Temperature' both in Kelvin (K).</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    lstDataset <span class="op">=</span> ee.ImageCollection(<span class="st">"MODIS/061/MOD11A1"</span>)<span class="op">\</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>                   .<span class="bu">filter</span>(ee.Filter.date(<span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-05-01'</span>, <span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-10-01'</span>))</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    lstmean_celsius <span class="op">=</span> lstDataset.select(<span class="st">'LST_Day_1km'</span>)<span class="op">\</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>                                .mean()<span class="op">\</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>                                .multiply(<span class="fl">0.02</span>)<span class="op">\</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>                                .subtract(<span class="fl">273.15</span>)<span class="op">\</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>                                .rename(<span class="st">'LST_DAY'</span>)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load MODIS Land Surface Temperature NIGHT</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    lstDataset_night <span class="op">=</span> ee.ImageCollection(<span class="st">"MODIS/061/MOD11A1"</span>)<span class="op">\</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>                         .<span class="bu">filter</span>(ee.Filter.date(<span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-05-01'</span>, <span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-10-01'</span>))</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    lstmean_celsius_night <span class="op">=</span> lstDataset_night.select(<span class="st">'LST_Night_1km'</span>)<span class="op">\</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>                                              .mean()<span class="op">\</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>                                              .multiply(<span class="fl">0.02</span>)<span class="op">\</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>                                              .subtract(<span class="fl">273.15</span>)<span class="op">\</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>                                              .rename(<span class="st">'LST_NIGHT'</span>)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Photosynthetically Active Radiation Daily 3-Hour </span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="co">#`GMT_1200_PAR` parameter of the dataset which provides 'Total PAR at GMT 12:00'. PAR is incident solar radiation in</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the visible spectrum (400-700 nanometers) and is an important variable in land-surface models having use in agriculture &amp;</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># other scientific applications.</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    par_12 <span class="op">=</span> ee.ImageCollection(<span class="st">"MODIS/061/MCD18C2"</span>)<span class="op">\</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>               .<span class="bu">filter</span>(ee.Filter.date(<span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-05-01'</span>, <span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-10-01'</span>))<span class="op">\</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>               .select(<span class="st">'GMT_1200_PAR'</span>)</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    mean_par_12 <span class="op">=</span> par_12.mean().rename(<span class="st">'PAR'</span>)<span class="op">;</span> <span class="co"># Calculate the Photosynthetically Active Radiation at 12</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Net Evapotranspiration</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `ET` parameter of the dataset which provides 'Total evapotranspiration' in kg/m^2/8day.s.</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    netevapo <span class="op">=</span> ee.ImageCollection(<span class="st">"MODIS/061/MOD16A2GF"</span>)<span class="op">\</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>                 .<span class="bu">filter</span>(ee.Filter.date(<span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-05-01'</span>, <span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-10-01'</span>))<span class="op">\</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>                 .select(<span class="st">'ET'</span>)</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    mean_netevapo <span class="op">=</span> netevapo.mean().rename(<span class="st">'ET'</span>)  <span class="co"># Calculate the mean Soil Moisture</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine all layers</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    combinedDataset <span class="op">=</span> cornNDVI.addBands(mean_precipitation).addBands(mean_s1_vv).addBands(mean_soil_moisture).addBands(lstmean_celsius).addBands(meanSoilMoisture_pm).addBands(lstmean_celsius_night).addBands(mean_par_12).addBands(mean_netevapo)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reduce regions and calculate mean values over the specified areas</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    combined_mean <span class="op">=</span> combinedDataset.reduceRegions(</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        collection<span class="op">=</span>nd,</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        reducer<span class="op">=</span>ee.Reducer.mean(),</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        scale<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        tileScale<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define export parameters</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    export_params <span class="op">=</span> {</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="st">'collection'</span>: combined_mean,</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        <span class="st">'description'</span>: <span class="ss">f'combined_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        <span class="st">'folder'</span>: <span class="st">'GEE_Folder'</span>,</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        <span class="st">'fileNamePrefix'</span>: <span class="ss">f'Combined_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">'fileFormat'</span>: <span class="st">'CSV'</span>,</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        <span class="st">'selectors'</span>: [<span class="st">'NAME'</span>, <span class="st">'GEOID'</span>, <span class="st">'NDVI'</span>, <span class="st">'PA'</span>, <span class="st">'SAR'</span>, <span class="st">'SMS_AM'</span>, <span class="st">'LST_DAY'</span>, <span class="st">'SMS_PM'</span>, <span class="st">'LST_NIGHT'</span>, <span class="st">'PAR'</span>, <span class="st">'ET'</span>]</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Commented the line below as I have got the data in my drive already</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ee.batch.Export.table.toDrive(**export_params).start()</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of processing each year</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2000</span>, <span class="dv">2024</span>):</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    processYear(year)</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> This part need to be filled</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="methodolog" class="level3">
<h3 class="anchored" data-anchor-id="methodolog">Methodolog</h3>
<ul>
<li>The Interface Code is as follows : y```js</li>
</ul>
<pre><code>
```js

// ——————————————————————————define crop layers———————————————————————————————

var cropLayers = {
  Corn: {
    // Add layers of corn
    '2018': ee.Image("projects/ee-songzimeng/assets/corn2018"),
    '2019': ee.Image("projects/ee-songzimeng/assets/corn2019"),
    '2020': ee.Image("projects/ee-songzimeng/assets/corn2020"),
    '2021': ee.Image("projects/ee-songzimeng/assets/corn2021"),
    '2022': ee.Image("projects/ee-songzimeng/assets/corn2022"),
    '2023': ee.Image("projects/ee-songzimeng/assets/corn2023"),
    '2024': ee.Image("projects/ee-songzimeng/assets/corn2024")
    
  },
  
  Soybean: {
    // Add layers of soybean

    '2018': ee.Image("projects/ee-songzimeng/assets/soybean2018"),
    '2019': ee.Image("projects/ee-songzimeng/assets/soybean2019"),
    '2020': ee.Image("projects/ee-songzimeng/assets/soybean2020"),
    '2021': ee.Image("projects/ee-songzimeng/assets/soybean2021"),
    '2022': ee.Image("projects/ee-songzimeng/assets/soybean2022"),
    '2023': ee.Image("projects/ee-songzimeng/assets/soybean2023"),
    '2024': ee.Image("projects/ee-songzimeng/assets/soybean2024")
  },
  
  Wheat: {
    // Add layers of wheat

    '2018': ee.Image("projects/ee-songzimeng/assets/wheat2018"),
    '2019': ee.Image("projects/ee-songzimeng/assets/wheat2019"),
    '2020': ee.Image("projects/ee-songzimeng/assets/wheat2020"),
    '2021': ee.Image("projects/ee-songzimeng/assets/wheat2021"),
    '2022': ee.Image("projects/ee-songzimeng/assets/wheat2022"),
    '2023': ee.Image("projects/ee-songzimeng/assets/wheat2023"),
    '2024': ee.Image("projects/ee-songzimeng/assets/wheat2024")
  }
};

// -------------------------- Data  ------------------------------
Map.setCenter(-100.55, 47.5, 7);
Map.setOptions('SATELLITE');

// clip the north dakota
var counties = ee.FeatureCollection('TIGER/2016/Counties');
var nd = counties.filter(ee.Filter.eq('STATEFP', '38'));

// Formatted county name function
var nd = nd.map(function(feature) {
  var name = ee.String(feature.get('NAME')).toUpperCase().replace(' ', '', 'g');
  return feature.set('NAME', name);
});

// Show the county boundary
var ndCounties = ee.Image().byte().paint({
  featureCollection: nd,
  color: null, 
  width: 1
});

// Add the counties layer
Map.addLayer(ndCounties, {}, 'ND Counties');

/// ——————————————Function and global variables——————————————————————————
// Function to read csv
function readCsvFile(selectedYear, selectedCrop) {
  var fileName = selectedYear +'_'+ selectedCrop;
  var csvFile = ee.FeatureCollection('projects/ee-songzimeng/assets/' + fileName); 

  return csvFile;
}

// Function to fomat county name
function processCountyColumn(table) {
  var countyColumnName = 'County';
  function processCountyName(countyName) {
    return ee.String(countyName).toUpperCase().replace('\\s+', '');
  }
  
  var processedCountyColumn = table.map(function(feature) {
    var countyName = feature.get(countyColumnName);
    var processedCountyName = processCountyName(countyName);
    return feature.set(countyColumnName, processedCountyName);
  });
  
  // return FeatureCollection
  return processedCountyColumn;
}

var selectedCrop='Select...';
var selectedYear='Select...';
var soybeanPrice = 11.90; // 2024 average
var CornPrice = 41.68; // 2024 average
var wheatPrice = 6.07; // 2024 average
var cropPrice = 0; //

var crops = {
  'Corn': 1,
  'Wheat': 23,
  'Soybean': 5
};


// ————————————————interface——————————————————————————
// set default year
var defaultYear = '2018';

var cropYieldLayer = null;

var statsLabel_1 = ui.Label('Click on County to see info:');
var statsLabel_2 = ui.Label('Select an area to see info:');

// set original info status
statsLabel_1.style().set('shown', true);
statsLabel_2.style().set('shown', false);

// Clear button to remove all selected layers
var drawingTools = Map.drawingTools();
var clearButton = ui.Button({
  label: 'Clear Selected Area',
  onClick: function() {

    var layers = drawingTools.layers();

    layers.forEach(function(layer) {
      drawingTools.layers().remove(layer);
    });

    resultsPanel.clear();
  },
  style: {margin: '10px'}
});


// the main panel to select mode, year, croptype
var panel = ui.Panel({
  widgets: [
    
    ui.Label('North Dakota Crop Yield', {
      fontWeight: 'bold',
      fontSize: '22px',
      textAlign: 'center',
      stretch: 'horizontal'
      
    }),
    
    ui.Label('Select Mode:'),
    ui.Select({
      items: ['Select...','County Level', 'Area Level'],
      value: 'Select...',
      onChange: function(mode) {
        
        // operate different 
        if (mode === 'County Level') {
          // County Level
          statsLabel_1.style().set('shown', true);
          statsLabel_2.style().set('shown', false);
          
          // reset button
          panel.remove(clearButton);
          panel.add(clearButton);
          
          // ban polygon drawing selection
          var drawingTools = Map.drawingTools();
          drawingTools.setShown(false);
          
          //Function for getting value from image
          var getCalculation = function(countyName, cropYieldLayer) {
            var county = nd.filter(ee.Filter.eq('NAME', countyName)).first();
            var countyGeometry = county.geometry();
            
             //print(selectedYear, selectedCrop);
            var countyData=readCsvFile(selectedYear, selectedCrop);
            // print(countyData);
            countyData = processCountyColumn(countyData);
            
            resultsPanel.clear();
          
            var countStats = cropYieldLayer.reduceRegion({
              reducer: ee.Reducer.count(),
              geometry: countyGeometry,
              scale: 30,
              maxPixels: 1e9
            });
           //print(countStats);
          
            var selectedCounty = countyData.filter(ee.Filter.eq('County', countyName));
            var averYield = selectedCounty.reduceColumns({
            reducer: ee.Reducer.mean(),
            selectors: ['Value']
          });
            //print(averYield);
          
            // create labels
            var countyLabel = ui.Label({
              value: 'County: ' + countyName,
              style: {fontSize: '13px', padding: '0px 50px'}
            });
          
            var count_sumLabel = ui.Label({
              value: 'Calculating...',
              style: {fontSize: '13px', padding: '0px 50px'}
            });
          
          // update labels by calculating
          // get the mean yield data
            averYield.evaluate(function(result) {
              var meanYield = result.mean;
              var count_averYieldLabel = ui.Label({
                value: 'Average Yield: ' + meanYield.toFixed(2) + ' BU/Acre', 
                style: {fontSize: '13px', padding: '0px 50px'}
              });
                resultsPanel.add(count_averYieldLabel);
          });
          
            // calculate the area and total yield
            countStats.get('YIELDpredicted').evaluate(function(value){

              var areaInSqKm = (value / 1e6) * 900;
              var areaInAcres = areaInSqKm * 247.105;
              count_sumLabel.setValue('Crop Area: ' + areaInSqKm.toFixed(2) + 
                                      ' km² (' + areaInAcres.toFixed(2) + ' Acres)');
                                      
              averYield.evaluate(function(result) {
                var meanYield = result.mean;
                var totalYield = areaInAcres * meanYield;
                var count_totalYieldLabel = ui.Label({
                  value: 'Total Yield: ' + totalYield.toFixed(2) + ' BU', 
                  style: {fontSize: '13px', padding: '0px 50px'}
                });
                var yieldPrice = totalYield * cropPrice;
                var yieldPriceLabel = ui.Label({
                  value: 'Total Yield Value: ' + yieldPrice.toFixed(2) + ' $', 
                  style: {fontSize: '13px', padding: '0px 50px'}
                });
                resultsPanel.add(count_totalYieldLabel);
                resultsPanel.add(yieldPriceLabel);
          });
            });
          
            // add the new label to sub-panel
            resultsPanel.add(countyLabel);
            resultsPanel.add(count_sumLabel);
          };
          
          Map.unlisten()
          
            // create onclick function
          Map.onClick(function(coords) {
            
          var point = ee.Geometry.Point(coords.lon, coords.lat);
          var county = ee.Feature(nd.filterBounds(point).first());
          var countyName = county.get('NAME');
          countyName.evaluate(function(name) {
            getCalculation(name, cropYieldLayer);
          });
          })
          

          // Area level
        } else if (mode === 'Area Level') {

          statsLabel_1.style().set('shown', false);
          statsLabel_2.style().set('shown', true);
          
          // delet onclick monitor
          Map.unlisten()
          
          //reset button
          panel.remove(clearButton);
          panel.add(clearButton);
          
          // draw polygon
          var drawingTools = Map.drawingTools();
          drawingTools.setShown(true);
    
    
          // function under area level
          function initializeAreaLevelMode() {
            // create a new drawing tools
            var drawingTools = Map.drawingTools();
            drawingTools.setShown(true);
            
            drawingTools.onDraw(function(geometry) {
              // get the polygon user drawing
              var userPolygon = geometry;
              
              // calculate pixels number inside the polygon user draw
              var pixelCount = cropYieldLayer.reduceRegion({
                reducer: ee.Reducer.count(),
                geometry: userPolygon,
                scale: 30,
                maxPixels: 1e9
              });
              
              //calculate average yield user draw
             var meanStats = cropYieldLayer.reduceRegion({
              reducer: ee.Reducer.mean(),
              geometry: userPolygon,
              scale: 30,
              maxPixels: 1e9
            });
              // print(meanStats)

                // combined 2 results
              var results = ee.Dictionary({
                  meanYield: meanStats.get('YIELDpredicted'),
                  pixelCount: pixelCount.get('YIELDpredicted')
              });

              // calculate average yield, crop area, total yield, and update labels
              results.evaluate(function(values)  {
                resultsPanel.clear();
                
              var area_sumLabel = ui.Label({
                value: 'Calculating...',
                style: {fontSize: '14px', padding: '0px 50px'}
              });
              
              var meanYield_sumLabel = ui.Label({
                value: 'Calculating...',
                style:{fontSize: '14px', padding: '0px 50px'}
              });
              
              var count_totalYieldLabel = ui.Label({
                value: 'Calculating...',
                style:{fontSize: '14px', padding: '0px 50px'}
              });
          
              resultsPanel.add(area_sumLabel);
              resultsPanel.add(meanYield_sumLabel);
              resultsPanel.add(count_totalYieldLabel);
          
              meanYield_sumLabel.setValue('Average Yield: ' + values.meanYield.toFixed(2) + ' BU/Acre');
          
              var areaInSqKm = (values.pixelCount / 1e6) * 900;
              var areaInAcres = areaInSqKm * 247.105;
              area_sumLabel.setValue('Crop Area: ' + areaInSqKm.toFixed(2) + 
                                      ' km² (' + areaInAcres.toFixed(2) + ' Acres)');
                                      
              var totalYield = areaInAcres * values.meanYield;
              count_totalYieldLabel.setValue('Total Yield: ' + totalYield.toFixed(2) + ' BU'); 
               
              var yieldPrice = totalYield * cropPrice;
              var yieldPriceLabel = ui.Label({
                  value: 'Total Yield Value: ' + yieldPrice.toFixed(2) + ' $', 
                  style: {fontSize: '13px', padding: '0px 50px'}
                });
              resultsPanel.add(yieldPriceLabel);
                
                });
                
            });

          }
          initializeAreaLevelMode();
          
        }
        
      }
    }),
    
    ui.Label('Select Year:'),
    ui.Select({
      items: ['Select...', '2018', '2019', '2020', 
                 '2021', '2022', '2023', '2024'],
      value: 'Select...',
      onChange: function(year) {
        
        // update global variable selectedYear, the year user chose
        selectedYear = year;
        updateMap();

      }
    }),
    
    ui.Label('Select Crop:'),
    ui.Select({
      items: ['Select...', 'Soybean', 'Corn', 'Wheat'],
      value: 'Select...',
      onChange: function(crop) {
        
        selectedCrop = crop;
        
        // set cropPrice according to selected 
        if (selectedCrop === 'Soybean') {
          cropPrice = 11.90; 
        } else if (selectedCrop === 'Wheat') {
          cropPrice = 6.07; 
        } else if (selectedCrop === 'Corn') {
          cropPrice = 5.80; 
        } else {
          cropPrice = 0;
        }
        
        updateMap();
        
      }
    }),
    
    statsLabel_1,
    statsLabel_2
  ],
  style: {position: 'top-right'}
});

Map.add(panel);

// Add a sub-panel to show calculation info
var resultsPanel = ui.Panel({
  layout: ui.Panel.Layout.Flow('vertical'),
  style: {width: '310px'} 
});
panel.add(resultsPanel);

// update new layers accoording to user's selection
function updateMap() {

  // // Remove particular layers
  // Map.layers().forEach(function(layer) {
  //   var layerName = layer.getName();
  //   if (layerName.indexOf('YIELD_') === 0) {
  //     Map.remove(layer);
  //   }
  // });
  
  Maay
```.reset();

  // Show layers if user choose both selections
  if (selectedYear !== 'Select...' &amp;&amp; selectedCrop !== 'Select...') {
    
      cropYieldLayer = cropLayers[selectedCrop][selectedYear];

    if (cropYieldLayer) {
      var layerName = selectedCrop + '_' + selectedYear;
      Map.addLayer(cropYieldLayer, {}, 'YIELD_' + layerName);
    }

  }
  
  // add the counties layer
  Map.addLayer(ndCounties, {}, 'ND Counties');
  
}

```:

### Interface Code:

![](Captnknure.JPG)

## **Project Summary**

CROPINVEST - Crop Yield Estimator for the State of North Dakota, USA

## **Problem Statement**

What is the problem you’re trying to address using this application? 

## **End User**

Who are you building this application for? How does it address a need this community has?

## **Data**

Datasets that we have used &amp; the relevant data from the dataset which we have used are described below in detail:-

1. **United States Census Bureau TIGER Dataset**
   It contains the boundary information i.e. counties of states which are the primary legal divisions units of US states.
    - *Dataset:* ee.ImageCollection("TIGER/2016/Counties")
    - *Dataset Provider:* United States Census Bureau
    - *Data Used for our Study:* `STATEFP` parameter of the dataset which provides the State FIPS code &amp; the North Dakota value is used.
&lt;br&gt;&lt;br&gt;     
2. **USDA NASS Cropland Data Layers**
   It is a crop-specific land cover data layer created annually for the continental United States using moderate resolution satellite imagery and extensive agricultural ground truth.
    - *Dataset:* ee.FeatureCollection("USDA/NASS/CDL")
    - *Dataset Provider:* USDA National Agricultural Statistics Service
    - *Data Used for our Study:* `cropland` values for different crops of our study are used Wheat, Corn &amp; Soybean Values provided from the Cropland Table.
&lt;br&gt;&lt;br&gt;     
3. **MOD13Q1.061 Terra Vegetation Indices 16-Day Global**
   It provides Normalized Difference Vegetation Index (NDVI) value on a per pixel basis. 
    - *Dataset:* ee.ImageCollection("MODIS/061/MOD13Q1")
    - *Dataset Provider:* NASA LP DAAC at the USGS EROS Center
    - *Data Used for our Study:* `NDVI` parameter of the dataset which provides the Normalized Difference Vegetation Index.
&lt;br&gt;&lt;br&gt;     
4. **GRIDMET:Gridded Surface Meteorological Dataset**
   It provides the high spatial resolution (~4-km) daily surface fields of temperature, precipitation, winds, humidity and radiation across the contiguous United States from 1979. 
    - *Dataset:* ee.ImageCollection("IDAHO_EPSCOR/GRIDMET")
    - *Dataset Provider:* USDA National Agricultural Statistics Service
    - *Data Used for our Study:* `pr` parameter of the dataset which provides the 'Precipitation amount' in mm (daily total)
&lt;br&gt;&lt;br&gt;      
5. **Sentinel-1 SAR GRD**
   It contains the boundary information i.e. counties of states which are the primary legal divisions units of US states.
    - *Dataset:* ee.ImageCollection("COPERNICUS/S1_GRD")
    - *Dataset Provider:* European Union/ESA/Copernicus
    - *Data Used for our Study:* `VV` parameter of the dataset which provides 'Single co-polarization, vertical transmit/vertical receive' in dB.
&lt;br&gt;&lt;br&gt; 
6. **SPL3SMP_E.005 SMAP L3 Radiometer Global Daily 9km Soil Moisture**
   It provides a daily composite of global land surface conditions retrieved by the Soil Moisture Active Passive (SMAP) L-Band radiometer. The daily data here were collected from the descending (local solar time of 6 am) and ascending (local solar time of 6 pm) passes.
    - *Dataset:* ee.ImageCollection("NASA/SMAP/SPL3SMP_E/005")
    - *Dataset Provider:* Google and NSIDC
    - *Data Used for our Study:* `soil_moisture_am` &amp; `soil_moisture_pm`parameter of the dataset which provides 'Retrieved soil moisture estimate from the disaggregated/downscaled vertical polarization brightness temperature at 9-km grid cell one at AM overpass &amp; other at  PM overpass.in dB.
&lt;br&gt;&lt;br&gt;
7. **MOD11A1.061 Terra Land Surface Temperature**
   MOD11A1 V6.1 product provides daily land surface temperature (LST) along with other parameters.
    - *Dataset:* ee.ImageCollection("NASA/SMAP/SPL3SMP_E/005")
    - *Dataset Provider:* NASA LP DAAC at the USGS EROS Center
    - *Data Used for our Study:* `LST_Day_1km` &amp; `LST_Night_1km`parameter of the dataset which provides 'Daytime Land Surface Temperature' &amp; Daytime Land Surface Temperature' both in Kelvin (K).
&lt;br&gt;&lt;br&gt;
8. **MCD18C2.061 Photosynthetically Active Radiation Daily 3 hour**
   The MCD18C2 Version 6.1 is a Moderate Resolution Imaging Spectroradiometer (MODIS) Terra and Aqua combined Photosynthetically Active Radiation (PAR) gridded Level 3 product produced daily at 0.05 degree (5,600 meters at the equator) resolution with estimates of PAR every 3 hours. 
    - *Dataset:* ee.ImageCollection("MODIS/061/MCD18C2")
    - *Dataset Provider:* NASA LP DAAC at the USGS EROS Center
    - *Data Used for our Study:* `GMT_1200_PAR` parameter of the dataset which provides 'Total PAR at GMT 12:00'.PAR is incident solar radiation in the visible spectrum (400-700 nanometers) and is an important variable in land-surface models having use in agriculture &amp; other scientific applications.
&lt;br&gt;&lt;br&gt;
9. **MOD16A2GF.061: Terra Net Evapotranspiration**
   It includes inputs of daily meteorological reanalysis data along with MODIS remotely sensed data products such as vegetation property dynamics, albedo, and land cover.
The pixel values for the two Evapotranspiration layers (ET and PET) are the sum of all eight days within the composite period, and the pixel values for the two Latent Heat layers (LE and PLE) are the average of all eight days within the composite peri.
   - *Dataset:* ee.ImageCollection("MODIS/061/MOD16A2GF")
   - *Dataset Provider:* NASA LP DAAC at the USGS EROS Center
   - *Data Used for our Study:* `ET` parameter of the dataset which provides 'Total evapotranspiration' in kg/m^2/8day.s.
&lt;br&gt;&lt;br&gt;

## **Methodology**

Previous studies showed that RF is an effective and universal machine learning method for crop yield prediction on a regional and global scale with high accuracy and precision and ease of use (Jeong et al., 2016.; Prasad et al., 2021).

### Building Random Forest Model:

1. **Prepare original CSV including the three types of crop among several X variables and Y variable (the crop yield)**
   
2. **Prepare training/validation data**    

3. **Use the training data to train three different RF Models in GEE**

### Validation

To get the performance of our models, we can use the test data from the previous split. We used R square and Root Mean Squared Error (RMSE) to validate our models. There are some graphs showing these metrics: 

:::{.column-page}

&lt;div style="position: relative; width: 100%; height: 0; padding-top: 56.2500%;
 padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 1.6em; margin-bottom: 0.9em; overflow: hidden;
 border-radius: 8px; will-change: transform;"&gt;
  &lt;iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;"
    src="https:&amp;#x2F;&amp;#x2F;www.canva.com&amp;#x2F;design&amp;#x2F;DAGC-BnkFTM&amp;#x2F;htfGBGmKgWUiwQRlwaqXgQ&amp;#x2F;view?embed" allowfullscreen="allowfullscreen" allow="fullscreen"&gt;
  &lt;/iframe&gt;
&lt;/div&gt;

:::

## **Interface**

Here is a presentation to show, how our application work:

&lt;div style="position: relative; width: 100%; height: 0; padding-top: 56.2500%;
 padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 1.6em; margin-bottom: 0.9em; overflow: hidden;
 border-radius: 8px; will-change: transform;"&gt;
  &lt;iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;"
    src="https:&amp;#x2F;&amp;#x2F;www.canva.com&amp;#x2F;design&amp;#x2F;DAGCq_eFmq8&amp;#x2F;Muz__V20V7SJUNr3EVBSEQ&amp;#x2F;view?embed" allowfullscreen="allowfullscreen" allow="fullscreen"&gt;
  &lt;/iframe&gt;
&lt;/div&gt;
&lt;a href="https:&amp;#x2F;&amp;#x2F;www.canva.com&amp;#x2F;design&amp;#x2F;DAGCq_eFmq8&amp;#x2F;Muz__V20V7SJUNr3EVBSEQ&amp;#x2F;view?utm_content=DAGCq_eFmq8&amp;amp;utm_campaign=designshare&amp;amp;utm_medium=embeds&amp;amp;utm_source=link" target="_blank" rel="noopener"&gt;CropInvest-Burhan&lt;/a&gt;


## **The Application**

:::{.column-page}

&lt;iframe src='https://songzimeng.users.earthengine.app/view/north-dakota-crop-yield' width='100%' height='700px'&gt;&lt;/iframe&gt;

:::

## **How it Works**

### Data Extraction Code:
- Here we use the Python environment to extract the data from different datasets using Google Earth Engine API
- Afterwards, we first use the crop-specific land cover data to distinguish different crops- wheat, soybean or corn for each county in North Dakota.
- Further, NDVI, Precipitation, SAR, Soil Moisture &amp; other values are used to get the county-wise values from the year 2000-2024.
- Afterwards, the Yield data is obtained from the [United States Department of Agriculture](https://quickstats.nass.usda.gov/) for each of the years and a final dataset is obtained which has all the X Variables (GEOID,NDVI,PA,SAR,SMS_AM,LST_DAY,SMS_PM,LST_NIGHT,PAR,ET) &amp; Y variable (YIELD).

```python

pip install earthengine-api
import ee
ee.AuthcessYear(year):
    # Load the CDL dataset for the given year
    dataset = ee.ImageCollection('USDA/NASS/CDL')\
                .filter(ee.Filter.date(f'{year}-01-01', f'{year}-12-31'))\
                .first()
    crop_landcover = dataset.select('cropland')

    # Filter for North Dakota counties
    #`STATEFP` parameter of the dataset which provides the State FIPS code &amp; the North Dakota value is used.
    counties = ee.FeatureCollection('TIGER/2016/Counties')
    nd = counties.filter(ee.Filter.eq('STATEFP', '38'))
    
    # Identify corn areas in North Dakota
    #`cropland` values for different crops of our study are used Wheat, Corn &amp; Soybean Values provided from the Cropland Table.
    corn = crop_landcover.eq(1).Or(crop_landcover.eq(12)).Or(crop_landcover.eq(13))
    masked_corn = crop_landcover.updateMask(corn).clipToCollection(nd)

    # Calculate NDVI for corn areas using MODIS data
    #`NDVI` parameter of the dataset and we obtain the mean over the growth period of the crop
    NDVI_dataset = ee.ImageCollection('MODIS/061/MOD13Q1')\
                    .filter(ee.Filter.date(f'{year}-05-01', f'{year}-10-01'))
    ndvi = NDVI_dataset.select('NDVI')
    mean_ndvi = ndvi.mean().rename('NDVI')
    cornNDVI = mean_ndvi.updateMask(masked_corn)
    
    # Calculate precipitation using GRIDMET data
    #`pr` parameter of the dataset which provides the 'Precipitation amount' in mm (daily total)
    precipitation_dataset = ee.ImageCollection("IDAHO_EPSCOR/GRIDMET")\
                             .filter(ee.Filter.date(f'{year}-05-01', f'{year}-10-01'))\
                             .select('pr')
    mean_precipitation = precipitation_dataset.mean().rename('PA')

    # Load Sentinel-1 C-band SAR Image Collection for the given year, select VV polarization
    #`VV` parameter of the dataset which provides 'Single co-polarization, vertical transmit/vertical receive' in dB.
    s1_dataset = ee.ImageCollection("COPERNICUS/S1_GRD")\
                   .filter(ee.Filter.eq('instrumentMode', 'IW'))\
                   .filter(ee.Filter.listContains('transmitterReceiverPolarisation', 'VV'))\
                   .filter(ee.Filter.date(f'{year}-01-01', f'{year}-12-31'))\
                   .select('VV')
    mean_s1_vv = s1_dataset.mean().rename('SAR')

    # Load Radiometer Global Daily 9 km Soil Moisture AM
    #`soil_moisture_am` &amp; `soil_moisture_pm` parameter of the dataset which provides 'Retrieved soil moisture estimate from the
    # disaggregated/downscaled vertical polarization brightness temperature at 9-km grid cell one at AM overpass &amp; other at  PM overpass. in dB.
    smap_dataset = ee.ImageCollection("NASA/SMAP/SPL3SMP_E/005")\
                    .filter(ee.Filter.date(f'{year}-05-01', f'{year}-10-01'))\
                    .select('soil_moisture_am')
    mean_soil_moisture = smap_dataset.mean().rename('SMS_AM')
    # Load Radiometer Global Daily 9 km Soil Moisture PM

    smapDataset_pm = ee.ImageCollection("NASA/SMAP/SPL3SMP_E/005")\
                       .filter(ee.Filter.date(f'{year}-05-01', f'{year}-10-01'))\
                       .select('soil_moisture_am') 
    meanSoilMoisture_pm = smapDataset_pm.mean().rename('SMS_PM')
    
    # Load MODIS Land Surface Temperature DAY
    #`LST_Day_1km` &amp; `LST_Night_1km` parameter of the dataset which provides 'Daytime Land Surface Temperature' &amp;
    # Nighttime Land Surface Temperature' both in Kelvin (K).
    lstDataset = ee.ImageCollection("MODIS/061/MOD11A1")\
                   .filter(ee.Filter.date(f'{year}-05-01', f'{year}-10-01'))
 
    lstmean_celsius = lstDataset.select('LST_Day_1km')\
                                .mean()\
                                .multiply(0.02)\
                                .subtract(273.15)\
                                .rename('LST_DAY')
    # Load MODIS Land Surface Temperature NIGHT
    lstDataset_night = ee.ImageCollection("MODIS/061/MOD11A1")\
                         .filter(ee.Filter.date(f'{year}-05-01', f'{year}-10-01'))
 
    lstmean_celsius_night = lstDataset_night.select('LST_Night_1km')\
                                              .mean()\
                                              .multiply(0.02)\
                                              .subtract(273.15)\
                                              .rename('LST_NIGHT')
                         
    # Photosynthetically Active Radiation Daily 3-Hour 
    #`GMT_1200_PAR` parameter of the dataset which provides 'Total PAR at GMT 12:00'. PAR is incident solar radiation in
    # the visible spectrum (400-700 nanometers) and is an important variable in land-surface models having use in agriculture &amp;
    # other scientific applications.
    par_12 = ee.ImageCollection("MODIS/061/MCD18C2")\
               .filter(ee.Filter.date(f'{year}-05-01', f'{year}-10-01'))\
               .select('GMT_1200_PAR')
                        
    mean_par_12 = par_12.mean().rename('PAR'); # Calculate the Photosynthetically Active Radiation at 12

                         
    # Net Evapotranspiration
    # `ET` parameter of the dataset which provides 'Total evapotranspiration' in kg/m^2/8day.s.
    netevapo = ee.ImageCollection("MODIS/061/MOD16A2GF")\
                 .filter(ee.Filter.date(f'{year}-05-01', f'{year}-10-01'))\
                 .select('ET')
                    
    mean_netevapo = netevapo.mean().rename('ET')  # Calculate the mean Soil Moisture


    # Combine all layers
    combinedDataset = cornNDVI.addBands(mean_precipitation).addBands(mean_s1_vv).addBands(mean_soil_moisture).addBands(lstmean_celsius).addBands(meanSoilMoisture_pm).addBands(lstmean_celsius_night).addBands(mean_par_12).addBands(mean_netevapo)

    # Reduce regions and calculate mean values over the specified areas
    combined_mean = combinedDataset.reduceRegions(
        collection=nd,
        reducer=ee.Reducer.mean(),
        scale=30,
        tileScale=4,
    )

    # Define export parameters
    export_params = {
        'collection': combined_mean,
        'description': f'combined_{year}',
        'folder': 'GEE_Folder',
        'fileNamePrefix': f'Combined_{year}',
        'fileFormat': 'CSV',
        'selectors': ['NAME', 'GEOID', 'NDVI', 'PA', 'SAR', 'SMS_AM', 'LST_DAY', 'SMS_PM', 'LST_NIGHT', 'PAR', 'ET']
    }

    # Commented the line below as I have got the data in my drive already
    #ee.batch.Export.table.toDrive(**export_params).start()

# Example of processing each year
for year in range(2000, 2024):
    processYear(year)
</code></pre>
</section>
<section id="methodology-code" class="level3">
<h3 class="anchored" data-anchor-id="methodology-code">Methodology Code:</h3>
<ul>
<li>This part need to be filled</li>
</ul>
</section>
<section id="interface-code" class="level3">
<h3 class="anchored" data-anchor-id="interface-code">Interface Code:</h3>
<ul>
<li>The Interface Code is as follows :</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ——————————————————————————define crop layers————————————————————————————————</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> cropLayers <span class="op">=</span> {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Corn</span><span class="op">:</span> {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add layers of corn</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2018'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/corn2018"</span>)<span class="op">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2019'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/corn2019"</span>)<span class="op">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2020'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/corn2020"</span>)<span class="op">,</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2021'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/corn2021"</span>)<span class="op">,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2022'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/corn2022"</span>)<span class="op">,</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2023'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/corn2023"</span>)<span class="op">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2024'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/corn2024"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Soybean</span><span class="op">:</span> {</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add layers of soybean</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2018'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/soybean2018"</span>)<span class="op">,</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2019'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/soybean2019"</span>)<span class="op">,</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2020'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/soybean2020"</span>)<span class="op">,</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2021'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/soybean2021"</span>)<span class="op">,</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2022'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/soybean2022"</span>)<span class="op">,</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2023'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/soybean2023"</span>)<span class="op">,</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2024'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/soybean2024"</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Wheat</span><span class="op">:</span> {</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add layers of wheat</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2018'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/wheat2018"</span>)<span class="op">,</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2019'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/wheat2019"</span>)<span class="op">,</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2020'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/wheat2020"</span>)<span class="op">,</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2021'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/wheat2021"</span>)<span class="op">,</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2022'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/wheat2022"</span>)<span class="op">,</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2023'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/wheat2023"</span>)<span class="op">,</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2024'</span><span class="op">:</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">"projects/ee-songzimeng/assets/wheat2024"</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co">// -------------------------- Data  ------------------------------</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">100.55</span><span class="op">,</span> <span class="fl">47.5</span><span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setOptions</span>(<span class="st">'SATELLITE'</span>)<span class="op">;</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co">// clip the north dakota</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> counties <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">'TIGER/2016/Counties'</span>)<span class="op">;</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> nd <span class="op">=</span> counties<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'STATEFP'</span><span class="op">,</span> <span class="st">'38'</span>))<span class="op">;</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co">// Formatted county name function</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> nd <span class="op">=</span> nd<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(feature) {</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> name <span class="op">=</span> ee<span class="op">.</span><span class="fu">String</span>(feature<span class="op">.</span><span class="fu">get</span>(<span class="st">'NAME'</span>))<span class="op">.</span><span class="fu">toUpperCase</span>()<span class="op">.</span><span class="fu">replace</span>(<span class="st">' '</span><span class="op">,</span> <span class="st">''</span><span class="op">,</span> <span class="st">'g'</span>)<span class="op">;</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> feature<span class="op">.</span><span class="fu">set</span>(<span class="st">'NAME'</span><span class="op">,</span> name)<span class="op">;</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co">// Show the county boundary</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndCounties <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>()<span class="op">.</span><span class="fu">byte</span>()<span class="op">.</span><span class="fu">paint</span>({</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="dt">featureCollection</span><span class="op">:</span> nd<span class="op">,</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> </span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="co">// Add the counties layer</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(ndCounties<span class="op">,</span> {}<span class="op">,</span> <span class="st">'ND Counties'</span>)<span class="op">;</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="co">/// ——————————————Function and global variables——————————————————————————</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="co">// Function to read csv</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">readCsvFile</span>(selectedYear<span class="op">,</span> selectedCrop) {</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> fileName <span class="op">=</span> selectedYear <span class="op">+</span><span class="st">'_'</span><span class="op">+</span> selectedCrop<span class="op">;</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> csvFile <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">'projects/ee-songzimeng/assets/'</span> <span class="op">+</span> fileName)<span class="op">;</span> </span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> csvFile<span class="op">;</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="co">// Function to fomat county name</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">processCountyColumn</span>(table) {</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> countyColumnName <span class="op">=</span> <span class="st">'County'</span><span class="op">;</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">processCountyName</span>(countyName) {</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ee<span class="op">.</span><span class="fu">String</span>(countyName)<span class="op">.</span><span class="fu">toUpperCase</span>()<span class="op">.</span><span class="fu">replace</span>(<span class="st">'</span><span class="sc">\\</span><span class="st">s+'</span><span class="op">,</span> <span class="st">''</span>)<span class="op">;</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> processedCountyColumn <span class="op">=</span> table<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(feature) {</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> countyName <span class="op">=</span> feature<span class="op">.</span><span class="fu">get</span>(countyColumnName)<span class="op">;</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> processedCountyName <span class="op">=</span> <span class="fu">processCountyName</span>(countyName)<span class="op">;</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature<span class="op">.</span><span class="fu">set</span>(countyColumnName<span class="op">,</span> processedCountyName)<span class="op">;</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return FeatureCollection</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> processedCountyColumn<span class="op">;</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> selectedCrop<span class="op">=</span><span class="st">'Select...'</span><span class="op">;</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> selectedYear<span class="op">=</span><span class="st">'Select...'</span><span class="op">;</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> soybeanPrice <span class="op">=</span> <span class="fl">11.90</span><span class="op">;</span> <span class="co">// 2024 average</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> CornPrice <span class="op">=</span> <span class="fl">41.68</span><span class="op">;</span> <span class="co">// 2024 average</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> wheatPrice <span class="op">=</span> <span class="fl">6.07</span><span class="op">;</span> <span class="co">// 2024 average</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> cropPrice <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">//</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> crops <span class="op">=</span> {</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Corn'</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Wheat'</span><span class="op">:</span> <span class="dv">23</span><span class="op">,</span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Soybean'</span><span class="op">:</span> <span class="dv">5</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a><span class="co">// ————————————————interface——————————————————————————</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a><span class="co">// set default year</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> defaultYear <span class="op">=</span> <span class="st">'2018'</span><span class="op">;</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> cropYieldLayer <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> statsLabel_1 <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Click on County to see info:'</span>)<span class="op">;</span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> statsLabel_2 <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Select an area to see info:'</span>)<span class="op">;</span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a><span class="co">// set original info status</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>statsLabel_1<span class="op">.</span><span class="fu">style</span>()<span class="op">.</span><span class="fu">set</span>(<span class="st">'shown'</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>statsLabel_2<span class="op">.</span><span class="fu">style</span>()<span class="op">.</span><span class="fu">set</span>(<span class="st">'shown'</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a><span class="co">// Clear button to remove all selected layers</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> drawingTools <span class="op">=</span> <span class="bu">Map</span><span class="op">.</span><span class="fu">drawingTools</span>()<span class="op">;</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> clearButton <span class="op">=</span> ui<span class="op">.</span><span class="fu">Button</span>({</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">'Clear Selected Area'</span><span class="op">,</span></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>  <span class="dt">onClick</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> layers <span class="op">=</span> drawingTools<span class="op">.</span><span class="fu">layers</span>()<span class="op">;</span></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>    layers<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span>(layer) {</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>      drawingTools<span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">remove</span>(layer)<span class="op">;</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>    resultsPanel<span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">margin</span><span class="op">:</span> <span class="st">'10px'</span>}</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a><span class="co">// the main panel to select mode, year, croptype</span></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> panel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>  <span class="dt">widgets</span><span class="op">:</span> [</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'North Dakota Crop Yield'</span><span class="op">,</span> {</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span><span class="op">,</span></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'22px'</span><span class="op">,</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>      <span class="dt">textAlign</span><span class="op">:</span> <span class="st">'center'</span><span class="op">,</span></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stretch</span><span class="op">:</span> <span class="st">'horizontal'</span></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Select Mode:'</span>)<span class="op">,</span></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Select</span>({</span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>      <span class="dt">items</span><span class="op">:</span> [<span class="st">'Select...'</span><span class="op">,</span><span class="st">'County Level'</span><span class="op">,</span> <span class="st">'Area Level'</span>]<span class="op">,</span></span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="st">'Select...'</span><span class="op">,</span></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>      <span class="dt">onChange</span><span class="op">:</span> <span class="kw">function</span>(mode) {</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>        <span class="co">// operate different </span></span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (mode <span class="op">===</span> <span class="st">'County Level'</span>) {</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>          <span class="co">// County Level</span></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>          statsLabel_1<span class="op">.</span><span class="fu">style</span>()<span class="op">.</span><span class="fu">set</span>(<span class="st">'shown'</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>          statsLabel_2<span class="op">.</span><span class="fu">style</span>()<span class="op">.</span><span class="fu">set</span>(<span class="st">'shown'</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>          <span class="co">// reset button</span></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>          panel<span class="op">.</span><span class="fu">remove</span>(clearButton)<span class="op">;</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>          panel<span class="op">.</span><span class="fu">add</span>(clearButton)<span class="op">;</span></span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>          <span class="co">// ban polygon drawing selection</span></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>          <span class="kw">var</span> drawingTools <span class="op">=</span> <span class="bu">Map</span><span class="op">.</span><span class="fu">drawingTools</span>()<span class="op">;</span></span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>          drawingTools<span class="op">.</span><span class="fu">setShown</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>          <span class="co">//Function for getting value from image</span></span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>          <span class="kw">var</span> getCalculation <span class="op">=</span> <span class="kw">function</span>(countyName<span class="op">,</span> cropYieldLayer) {</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> county <span class="op">=</span> nd<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'NAME'</span><span class="op">,</span> countyName))<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> countyGeometry <span class="op">=</span> county<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>             <span class="co">//print(selectedYear, selectedCrop);</span></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> countyData<span class="op">=</span><span class="fu">readCsvFile</span>(selectedYear<span class="op">,</span> selectedCrop)<span class="op">;</span></span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>            <span class="co">// print(countyData);</span></span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>            countyData <span class="op">=</span> <span class="fu">processCountyColumn</span>(countyData)<span class="op">;</span></span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>            resultsPanel<span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> countStats <span class="op">=</span> cropYieldLayer<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>              <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>()<span class="op">,</span></span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>              <span class="dt">geometry</span><span class="op">:</span> countyGeometry<span class="op">,</span></span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>              <span class="dt">scale</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>              <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span></span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>           <span class="co">//print(countStats);</span></span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> selectedCounty <span class="op">=</span> countyData<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'County'</span><span class="op">,</span> countyName))<span class="op">;</span></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> averYield <span class="op">=</span> selectedCounty<span class="op">.</span><span class="fu">reduceColumns</span>({</span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>            <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>            <span class="dt">selectors</span><span class="op">:</span> [<span class="st">'Value'</span>]</span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>            <span class="co">//print(averYield);</span></span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>            <span class="co">// create labels</span></span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> countyLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>              <span class="dt">value</span><span class="op">:</span> <span class="st">'County: '</span> <span class="op">+</span> countyName<span class="op">,</span></span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>              <span class="dt">style</span><span class="op">:</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'13px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 50px'</span>}</span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> count_sumLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>              <span class="dt">value</span><span class="op">:</span> <span class="st">'Calculating...'</span><span class="op">,</span></span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>              <span class="dt">style</span><span class="op">:</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'13px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 50px'</span>}</span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>          <span class="co">// update labels by calculating</span></span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>          <span class="co">// get the mean yield data</span></span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>            averYield<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(result) {</span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> meanYield <span class="op">=</span> result<span class="op">.</span><span class="at">mean</span><span class="op">;</span></span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> count_averYieldLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> <span class="st">'Average Yield: '</span> <span class="op">+</span> meanYield<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">' BU/Acre'</span><span class="op">,</span> </span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>                <span class="dt">style</span><span class="op">:</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'13px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 50px'</span>}</span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>              })<span class="op">;</span></span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>                resultsPanel<span class="op">.</span><span class="fu">add</span>(count_averYieldLabel)<span class="op">;</span></span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>            <span class="co">// calculate the area and total yield</span></span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>            countStats<span class="op">.</span><span class="fu">get</span>(<span class="st">'YIELDpredicted'</span>)<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(value){</span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> areaInSqKm <span class="op">=</span> (value <span class="op">/</span> <span class="fl">1e6</span>) <span class="op">*</span> <span class="dv">900</span><span class="op">;</span></span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> areaInAcres <span class="op">=</span> areaInSqKm <span class="op">*</span> <span class="fl">247.105</span><span class="op">;</span></span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>              count_sumLabel<span class="op">.</span><span class="fu">setValue</span>(<span class="st">'Crop Area: '</span> <span class="op">+</span> areaInSqKm<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> </span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">' km² ('</span> <span class="op">+</span> areaInAcres<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">' Acres)'</span>)<span class="op">;</span></span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>                                      </span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>              averYield<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(result) {</span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> meanYield <span class="op">=</span> result<span class="op">.</span><span class="at">mean</span><span class="op">;</span></span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> totalYield <span class="op">=</span> areaInAcres <span class="op">*</span> meanYield<span class="op">;</span></span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> count_totalYieldLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span> <span class="st">'Total Yield: '</span> <span class="op">+</span> totalYield<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">' BU'</span><span class="op">,</span> </span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">style</span><span class="op">:</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'13px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 50px'</span>}</span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>                })<span class="op">;</span></span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> yieldPrice <span class="op">=</span> totalYield <span class="op">*</span> cropPrice<span class="op">;</span></span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> yieldPriceLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span> <span class="st">'Total Yield Value: '</span> <span class="op">+</span> yieldPrice<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">' $'</span><span class="op">,</span> </span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">style</span><span class="op">:</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'13px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 50px'</span>}</span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a>                })<span class="op">;</span></span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>                resultsPanel<span class="op">.</span><span class="fu">add</span>(count_totalYieldLabel)<span class="op">;</span></span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>                resultsPanel<span class="op">.</span><span class="fu">add</span>(yieldPriceLabel)<span class="op">;</span></span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>            <span class="co">// add the new label to sub-panel</span></span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>            resultsPanel<span class="op">.</span><span class="fu">add</span>(countyLabel)<span class="op">;</span></span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>            resultsPanel<span class="op">.</span><span class="fu">add</span>(count_sumLabel)<span class="op">;</span></span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>          }<span class="op">;</span></span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>          <span class="bu">Map</span><span class="op">.</span><span class="fu">unlisten</span>()</span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>            <span class="co">// create onclick function</span></span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>          <span class="bu">Map</span><span class="op">.</span><span class="fu">onClick</span>(<span class="kw">function</span>(coords) {</span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>          <span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>(coords<span class="op">.</span><span class="at">lon</span><span class="op">,</span> coords<span class="op">.</span><span class="at">lat</span>)<span class="op">;</span></span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>          <span class="kw">var</span> county <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(nd<span class="op">.</span><span class="fu">filterBounds</span>(point)<span class="op">.</span><span class="fu">first</span>())<span class="op">;</span></span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>          <span class="kw">var</span> countyName <span class="op">=</span> county<span class="op">.</span><span class="fu">get</span>(<span class="st">'NAME'</span>)<span class="op">;</span></span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>          countyName<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(name) {</span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>            <span class="fu">getCalculation</span>(name<span class="op">,</span> cropYieldLayer)<span class="op">;</span></span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>          })</span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Area level</span></span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (mode <span class="op">===</span> <span class="st">'Area Level'</span>) {</span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>          statsLabel_1<span class="op">.</span><span class="fu">style</span>()<span class="op">.</span><span class="fu">set</span>(<span class="st">'shown'</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>          statsLabel_2<span class="op">.</span><span class="fu">style</span>()<span class="op">.</span><span class="fu">set</span>(<span class="st">'shown'</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a>          <span class="co">// delet onclick monitor</span></span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>          <span class="bu">Map</span><span class="op">.</span><span class="fu">unlisten</span>()</span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a>          <span class="co">//reset button</span></span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>          panel<span class="op">.</span><span class="fu">remove</span>(clearButton)<span class="op">;</span></span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a>          panel<span class="op">.</span><span class="fu">add</span>(clearButton)<span class="op">;</span></span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a>          <span class="co">// draw polygon</span></span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a>          <span class="kw">var</span> drawingTools <span class="op">=</span> <span class="bu">Map</span><span class="op">.</span><span class="fu">drawingTools</span>()<span class="op">;</span></span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a>          drawingTools<span class="op">.</span><span class="fu">setShown</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a>          <span class="co">// function under area level</span></span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>          <span class="kw">function</span> <span class="fu">initializeAreaLevelMode</span>() {</span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a>            <span class="co">// create a new drawing tools</span></span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> drawingTools <span class="op">=</span> <span class="bu">Map</span><span class="op">.</span><span class="fu">drawingTools</span>()<span class="op">;</span></span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a>            drawingTools<span class="op">.</span><span class="fu">setShown</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a>            drawingTools<span class="op">.</span><span class="fu">onDraw</span>(<span class="kw">function</span>(geometry) {</span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a>              <span class="co">// get the polygon user drawing</span></span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> userPolygon <span class="op">=</span> geometry<span class="op">;</span></span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>              <span class="co">// calculate pixels number inside the polygon user draw</span></span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> pixelCount <span class="op">=</span> cropYieldLayer<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>                <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>()<span class="op">,</span></span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a>                <span class="dt">geometry</span><span class="op">:</span> userPolygon<span class="op">,</span></span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a>                <span class="dt">scale</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a>                <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span></span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a>              })<span class="op">;</span></span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a>              <span class="co">//calculate average yield user draw</span></span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a>             <span class="kw">var</span> meanStats <span class="op">=</span> cropYieldLayer<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a>              <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a>              <span class="dt">geometry</span><span class="op">:</span> userPolygon<span class="op">,</span></span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a>              <span class="dt">scale</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a>              <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span></span>
<span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>              <span class="co">// print(meanStats)</span></span>
<span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a>                <span class="co">// combined 2 results</span></span>
<span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> results <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>({</span>
<span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">meanYield</span><span class="op">:</span> meanStats<span class="op">.</span><span class="fu">get</span>(<span class="st">'YIELDpredicted'</span>)<span class="op">,</span></span>
<span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">pixelCount</span><span class="op">:</span> pixelCount<span class="op">.</span><span class="fu">get</span>(<span class="st">'YIELDpredicted'</span>)</span>
<span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>              })<span class="op">;</span></span>
<span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a>              <span class="co">// calculate average yield, crop area, total yield, and update labels</span></span>
<span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a>              results<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(values)  {</span>
<span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a>                resultsPanel<span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> area_sumLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> <span class="st">'Calculating...'</span><span class="op">,</span></span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a>                <span class="dt">style</span><span class="op">:</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'14px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 50px'</span>}</span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a>              })<span class="op">;</span></span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> meanYield_sumLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> <span class="st">'Calculating...'</span><span class="op">,</span></span>
<span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a>                <span class="dt">style</span><span class="op">:</span>{<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'14px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 50px'</span>}</span>
<span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a>              })<span class="op">;</span></span>
<span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> count_totalYieldLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> <span class="st">'Calculating...'</span><span class="op">,</span></span>
<span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a>                <span class="dt">style</span><span class="op">:</span>{<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'14px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 50px'</span>}</span>
<span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a>              })<span class="op">;</span></span>
<span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a>              resultsPanel<span class="op">.</span><span class="fu">add</span>(area_sumLabel)<span class="op">;</span></span>
<span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a>              resultsPanel<span class="op">.</span><span class="fu">add</span>(meanYield_sumLabel)<span class="op">;</span></span>
<span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a>              resultsPanel<span class="op">.</span><span class="fu">add</span>(count_totalYieldLabel)<span class="op">;</span></span>
<span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a>              meanYield_sumLabel<span class="op">.</span><span class="fu">setValue</span>(<span class="st">'Average Yield: '</span> <span class="op">+</span> values<span class="op">.</span><span class="at">meanYield</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">' BU/Acre'</span>)<span class="op">;</span></span>
<span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> areaInSqKm <span class="op">=</span> (values<span class="op">.</span><span class="at">pixelCount</span> <span class="op">/</span> <span class="fl">1e6</span>) <span class="op">*</span> <span class="dv">900</span><span class="op">;</span></span>
<span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> areaInAcres <span class="op">=</span> areaInSqKm <span class="op">*</span> <span class="fl">247.105</span><span class="op">;</span></span>
<span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a>              area_sumLabel<span class="op">.</span><span class="fu">setValue</span>(<span class="st">'Crop Area: '</span> <span class="op">+</span> areaInSqKm<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> </span>
<span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">' km² ('</span> <span class="op">+</span> areaInAcres<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">' Acres)'</span>)<span class="op">;</span></span>
<span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a>                                      </span>
<span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> totalYield <span class="op">=</span> areaInAcres <span class="op">*</span> values<span class="op">.</span><span class="at">meanYield</span><span class="op">;</span></span>
<span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a>              count_totalYieldLabel<span class="op">.</span><span class="fu">setValue</span>(<span class="st">'Total Yield: '</span> <span class="op">+</span> totalYield<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">' BU'</span>)<span class="op">;</span> </span>
<span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a>               </span>
<span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> yieldPrice <span class="op">=</span> totalYield <span class="op">*</span> cropPrice<span class="op">;</span></span>
<span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> yieldPriceLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span> <span class="st">'Total Yield Value: '</span> <span class="op">+</span> yieldPrice<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">' $'</span><span class="op">,</span> </span>
<span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">style</span><span class="op">:</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'13px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 50px'</span>}</span>
<span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a>                })<span class="op">;</span></span>
<span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a>              resultsPanel<span class="op">.</span><span class="fu">add</span>(yieldPriceLabel)<span class="op">;</span></span>
<span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a>                })<span class="op">;</span></span>
<span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a>          <span class="fu">initializeAreaLevelMode</span>()<span class="op">;</span></span>
<span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Select Year:'</span>)<span class="op">,</span></span>
<span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Select</span>({</span>
<span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a>      <span class="dt">items</span><span class="op">:</span> [<span class="st">'Select...'</span><span class="op">,</span> <span class="st">'2018'</span><span class="op">,</span> <span class="st">'2019'</span><span class="op">,</span> <span class="st">'2020'</span><span class="op">,</span> </span>
<span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'2021'</span><span class="op">,</span> <span class="st">'2022'</span><span class="op">,</span> <span class="st">'2023'</span><span class="op">,</span> <span class="st">'2024'</span>]<span class="op">,</span></span>
<span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="st">'Select...'</span><span class="op">,</span></span>
<span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a>      <span class="dt">onChange</span><span class="op">:</span> <span class="kw">function</span>(year) {</span>
<span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a>        <span class="co">// update global variable selectedYear, the year user chose</span></span>
<span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a>        selectedYear <span class="op">=</span> year<span class="op">;</span></span>
<span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateMap</span>()<span class="op">;</span></span>
<span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Select Crop:'</span>)<span class="op">,</span></span>
<span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Select</span>({</span>
<span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a>      <span class="dt">items</span><span class="op">:</span> [<span class="st">'Select...'</span><span class="op">,</span> <span class="st">'Soybean'</span><span class="op">,</span> <span class="st">'Corn'</span><span class="op">,</span> <span class="st">'Wheat'</span>]<span class="op">,</span></span>
<span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="st">'Select...'</span><span class="op">,</span></span>
<span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a>      <span class="dt">onChange</span><span class="op">:</span> <span class="kw">function</span>(crop) {</span>
<span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a>        selectedCrop <span class="op">=</span> crop<span class="op">;</span></span>
<span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a>        <span class="co">// set cropPrice according to selected </span></span>
<span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (selectedCrop <span class="op">===</span> <span class="st">'Soybean'</span>) {</span>
<span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a>          cropPrice <span class="op">=</span> <span class="fl">11.90</span><span class="op">;</span> </span>
<span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (selectedCrop <span class="op">===</span> <span class="st">'Wheat'</span>) {</span>
<span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a>          cropPrice <span class="op">=</span> <span class="fl">6.07</span><span class="op">;</span> </span>
<span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (selectedCrop <span class="op">===</span> <span class="st">'Corn'</span>) {</span>
<span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a>          cropPrice <span class="op">=</span> <span class="fl">5.80</span><span class="op">;</span> </span>
<span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a>          cropPrice <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateMap</span>()<span class="op">;</span></span>
<span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a>    statsLabel_1<span class="op">,</span></span>
<span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a>    statsLabel_2</span>
<span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">position</span><span class="op">:</span> <span class="st">'top-right'</span>}</span>
<span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-407"><a href="#cb3-407" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">add</span>(panel)<span class="op">;</span></span>
<span id="cb3-408"><a href="#cb3-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-409"><a href="#cb3-409" aria-hidden="true" tabindex="-1"></a><span class="co">// Add a sub-panel to show calculation info</span></span>
<span id="cb3-410"><a href="#cb3-410" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> resultsPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb3-411"><a href="#cb3-411" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">Flow</span>(<span class="st">'vertical'</span>)<span class="op">,</span></span>
<span id="cb3-412"><a href="#cb3-412" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">width</span><span class="op">:</span> <span class="st">'310px'</span>} </span>
<span id="cb3-413"><a href="#cb3-413" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb3-414"><a href="#cb3-414" aria-hidden="true" tabindex="-1"></a>panel<span class="op">.</span><span class="fu">add</span>(resultsPanel)<span class="op">;</span></span>
<span id="cb3-415"><a href="#cb3-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-416"><a href="#cb3-416" aria-hidden="true" tabindex="-1"></a><span class="co">// update new layers accoording to user's selection</span></span>
<span id="cb3-417"><a href="#cb3-417" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">updateMap</span>() {</span>
<span id="cb3-418"><a href="#cb3-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-419"><a href="#cb3-419" aria-hidden="true" tabindex="-1"></a>  <span class="co">// // Remove particular layers</span></span>
<span id="cb3-420"><a href="#cb3-420" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Map.layers().forEach(function(layer) {</span></span>
<span id="cb3-421"><a href="#cb3-421" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   var layerName = layer.getName();</span></span>
<span id="cb3-422"><a href="#cb3-422" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   if (layerName.indexOf('YIELD_') === 0) {</span></span>
<span id="cb3-423"><a href="#cb3-423" aria-hidden="true" tabindex="-1"></a>  <span class="co">//     Map.remove(layer);</span></span>
<span id="cb3-424"><a href="#cb3-424" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   }</span></span>
<span id="cb3-425"><a href="#cb3-425" aria-hidden="true" tabindex="-1"></a>  <span class="co">// });</span></span>
<span id="cb3-426"><a href="#cb3-426" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-427"><a href="#cb3-427" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">reset</span>()<span class="op">;</span></span>
<span id="cb3-428"><a href="#cb3-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-429"><a href="#cb3-429" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Show layers if user choose both selections</span></span>
<span id="cb3-430"><a href="#cb3-430" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selectedYear <span class="op">!==</span> <span class="st">'Select...'</span> <span class="op">&amp;&amp;</span> selectedCrop <span class="op">!==</span> <span class="st">'Select...'</span>) {</span>
<span id="cb3-431"><a href="#cb3-431" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-432"><a href="#cb3-432" aria-hidden="true" tabindex="-1"></a>      cropYieldLayer <span class="op">=</span> cropLayers[selectedCrop][selectedYear]<span class="op">;</span></span>
<span id="cb3-433"><a href="#cb3-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-434"><a href="#cb3-434" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cropYieldLayer) {</span>
<span id="cb3-435"><a href="#cb3-435" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> layerName <span class="op">=</span> selectedCrop <span class="op">+</span> <span class="st">'_'</span> <span class="op">+</span> selectedYear<span class="op">;</span></span>
<span id="cb3-436"><a href="#cb3-436" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(cropYieldLayer<span class="op">,</span> {}<span class="op">,</span> <span class="st">'YIELD_'</span> <span class="op">+</span> layerName)<span class="op">;</span></span>
<span id="cb3-437"><a href="#cb3-437" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-438"><a href="#cb3-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-439"><a href="#cb3-439" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-440"><a href="#cb3-440" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-441"><a href="#cb3-441" aria-hidden="true" tabindex="-1"></a>  <span class="co">// add the counties layer</span></span>
<span id="cb3-442"><a href="#cb3-442" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(ndCounties<span class="op">,</span> {}<span class="op">,</span> <span class="st">'ND Counties'</span>)<span class="op">;</span></span>
<span id="cb3-443"><a href="#cb3-443" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>